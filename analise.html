<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/ico.png" type="image/x-icon">
    <title>Central de Avalia&ccedil;&atilde;o - Mapa indicador de Suprimentos 2026</title>
    <link rel="stylesheet" href="css/analise.css">
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-container">
            <div class="logo-loading">
                <svg viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
                    <rect class="rect-1" x="140" y="80" width="310" height="90" rx="15" fill="#FF5722"></rect>
                    <rect class="rect-2" x="90" y="210" width="310" height="90" rx="15" fill="#FF5722"></rect>
                    <rect class="rect-3" x="40" y="340" width="310" height="90" rx="15" fill="#4A5568"></rect>
                </svg>
            </div>
            <div class="loading-text">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
        </div>
    </div>

    <div class="chat-wrapper" id="chatWrapper">
        <div class="chat-header">
            <div class="logo-container">
                <svg class="logo-chat" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
                    <rect x="140" y="80" width="310" height="90" rx="15" fill="#FF5722"></rect>
                    <rect x="90" y="210" width="310" height="90" rx="15" fill="#FF5722"></rect>
                    <rect x="40" y="340" width="310" height="90" rx="15" fill="#4A5568"></rect>
                </svg>
            </div>
            <div class="header-info">
                <h1>ENGEMAN</h1>
                <p>Central de Avalia&ccedil;&atilde;o de Fornecedores</p>
            </div>
            <button class="settings-btn" id="settingsBtn" title="Configura&ccedil;&otilde;es">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09A1.65 1.65 0 0 0 9 3.09V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>
        </div>
        <div class="messages-container" id="messagesContainer">
            <div class="message bot-message">
                <div class="message-content">
                    <p>&#128075; Ol&aacute;! Bem-vindo &agrave; Central de Avalia&ccedil;&atilde;o de Fornecedores da <span class="span-color">ENGEMAN.</span><br>Selecione uma op&ccedil;&atilde;o para avan&ccedil;ar:</p>
                    <div id="main-menu">
                        <button class="menu-btn busca" onclick="openSupplierSearch()">
                            <span class="menu-icon" aria-hidden="true">
                                <svg viewBox="0 0 32 32">
                                    <circle cx="14" cy="14" r="8" />
                                    <path d="M21 21l7 7" />
                                </svg>
                            </span>
                            <span class="menu-label">Pesquisar Fornecedor</span>
                        </button>
                        <button class="menu-btn indicadores" onclick="showSubmenu('fornecedores')">
                            <span class="menu-icon" aria-hidden="true">
                                <svg viewBox="0 0 32 32">
                                    <path d="M5 27V6l4-2 4 2v21" />
                                    <path d="M13 27v-9l4-2 4 2v9" />
                                    <path d="M21 27v-5l4-2 4 2v5" />
                                    <circle cx="9" cy="11" r="1.6" />
                                    <circle cx="17" cy="18" r="1.6" />
                                    <circle cx="25" cy="22" r="1.6" />
                                </svg>
                            </span>
                            <span class="menu-label">Indicadores dos Fornecedores</span>
                        </button>
                        <button class="menu-btn mensais" onclick="showIndicadoresMensais()">
                            <span class="menu-icon" aria-hidden="true">
                                <svg viewBox="0 0 32 32">
                                    <path d="M7 5v4M25 5v4" />
                                    <rect x="5" y="9" width="22" height="18" rx="3" />
                                    <path d="M5 13h22" />
                                    <path d="M11 17h6" />
                                    <path d="M11 21h10" />
                                </svg>
                            </span>
                            <span class="menu-label">Indicadores Mensais</span>
                        </button>
                        <button class="menu-btn bases" onclick="contactBase()">
                            <span class="menu-icon" aria-hidden="true">
                                <svg viewBox="0 0 32 32">
                                    <path d="M6 8h20v4H6z" />
                                    <path d="M6 16h20v8H6z" />
                                    <path d="M11 12v12" />
                                    <path d="M21 12v12" />
                                    <circle cx="11" cy="20" r="1.6" />
                                    <circle cx="21" cy="20" r="1.6" />
                                </svg>
                            </span>
                            <span class="menu-label">Bases por Compradores</span>
                        </button>
                        <button class="menu-btn procedimento" onclick="showProcedimentoEngeman()">
                            <span class="menu-icon" aria-hidden="true">
                                <svg viewBox="0 0 32 32">
                                    <path d="M9 5h11l3 3v19H9z" />
                                    <path d="M9 12h15" />
                                    <path d="M14 16h6" />
                                    <path d="M14 20h9" />
                                    <path d="M14 24h9" />
                                    <path d="M9 5v23" />
                                </svg>
                            </span>
                            <span class="menu-label">Procedimento Engeman</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="input-area">
            <input
                type="text"
                id="userInput"
                class="chat-input"
                placeholder="Digite sua mensagem ou o e-mail do fornecedor"
                autocomplete="off">
            <input type="file" id="dataFilesInput" accept=".xlsx,.xls" multiple hidden>
            <button class="attach-btn" id="attachFilesBtn" type="button" aria-label="Anexar planilhas" title="Anexar planilhas (.xlsx)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21.44 11.05l-8.49 8.49a5 5 0 01-7.07-7.07l8.49-8.49a3.5 3.5 0 014.95 4.95l-8.49 8.49a2 2 0 01-2.83-2.83l7.78-7.78" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>
            <button class="send-btn" id="sendBtn" aria-label="Enviar mensagem">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <div class="bubbles-container">
        <div class="bubble bubble-1"></div>
        <div class="bubble bubble-2"></div>
        <div class="bubble bubble-3"></div>
        <div class="bubble bubble-4"></div>
        <div class="bubble bubble-5"></div>
    </div>

    <div class="settings-overlay" id="settingsOverlay" aria-hidden="true">
        <div class="settings-panel" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
            <div class="settings-header">
                <h2 id="settingsTitle">Configura&ccedil;&otilde;es avan&ccedil;adas</h2>
                <button class="close-settings" id="closeSettingsBtn" aria-label="Fechar configura&ccedil;&otilde;es">&times;</button>
            </div>
            <div class="settings-section">
                <h3>Integra&ccedil;&atilde;o com OpenAI</h3>
                <p class="settings-description">Informe sua chave privada para habilitar as an&aacute;lises com IA. O dado fica salvo apenas no seu navegador.</p>
                <div class="api-key-bar" id="apiKeyBar">
                    <label class="api-key-label" for="apiKeyInput">Chave OpenAI</label>
                    <div class="api-key-input-group">
                        <input
                            type="password"
                            id="apiKeyInput"
                            class="api-key-input"
                            placeholder="Cole aqui sua chave do GPT"
                            autocomplete="off"
                            spellcheck="false">
                        <button type="button" class="api-key-toggle" id="toggleApiKeyBtn" aria-label="Mostrar chave">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                    <div class="api-key-actions">
                        <button type="button" class="api-key-btn" id="applyApiKeyBtn">Aplicar chave</button>
                        <button type="button" class="api-key-btn subtle" id="clearApiKeyBtn">Limpar</button>
                    </div>
                    <span class="api-key-status" id="apiKeyStatus" aria-live="polite">Nenhuma chave informada</span>
                </div>
            </div>
            <div class="settings-section">
                <h3>Prefer&ecirc;ncias de e-mail</h3>
                <div class="settings-grid">
                    <label for="emailSubjectInput">
                        Assunto padr&atilde;o
                        <input type="text" id="emailSubjectInput" value="Feedback IQF - {{fornecedor}}">
                    </label>
                </div>
            </div>
            <div class="settings-actions">
                <button class="btn-secondary" id="clearSettingsBtn" type="button">Limpar</button>
                <button class="btn-primary" id="saveSettingsBtn" type="button">Salvar</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="js/analise.js" defer></script>
</body>
</html>
